% This is a simple sample document.  For more complicated documents take a look in the exercise tab. Note that everything that comes after a % symbol is treated as comment and ignored when the code is compiled.

\documentclass{article} % \documentclass{} is the first command in any LaTeX code.  It is used to define what kind of document you are creating such as an article or a book, and begins the document preamble
\usepackage{amssymb}
\usepackage{amsmath} % \usepackage is a command that allows you to add functionality to your LaTeX code

\title{Mission d'occulatation lunaire} % Sets article title
\author{Vincent Callegari} % Sets authors name
\date{\today} % Sets date for date compiled
\usepackage{graphicx}
\graphicspath{{./images/graph/}}
% The preamble ends with the command \begin{document}
	\begin{document}
		\maketitle
		\section{introduction}%flemme de faire cette partie pour l'instant
		\section{zone d'observation}
		\subsection{calcul de la zone exacte}
		
		during the study of these problems, we will take the earth as the orgin in cartesian coordinate. The axis Earth-Sun at time t0 will be defined as the X axis and the axis X and Y define the earth ecliptic plane. 
		
		for now we fix the time at (0,0)
		
		%durant l'étude de ces problèmes, on se place dans %le référentiel de la Terre avec des coordonnées %cartésienne, l'axe Terre-Soleil étant l'axe X avec
		%l'axe Y colinéaire au plan écliptique de la Terre. 
		
		a point is in the observation zone if the sun is totally hidden and the crown is visible around the occulting body. This zone has the shape of a double cone that we can represent by the rotation of a triangle.
		
		%un point est dans la zone d'observation quand le %soleil est totalement masqué et que la couronne %est visible autour de l'astre occultant. Cette %zone à la forme d'un double cône que l'on peut %représenter comme la rotation d'un losange %mettre un schéma pour être plus clair.
		
		the triangle could be defined by its three points
		$P_1$,$P_2$ et $P_3$, with as coordinates $(P_{1x},0,0)$ , $(P_{2x},P_{2y},0)$,$(P_{3x},0,0)$ 
		
		%le losange peut être définit par 3 points %$P_1$,$P_2$ et $P_3$, ayant pour coordonnée %$(P_{1x},0)$ , $(P_{2x},P_{2y})$,$(P_{3x},0)$ avec %$\hat{x}$ le long de l'axe lune soleil.
		
		the value of $P_{1x}$ and $P_{3x}$ can be easily computed usingt the Thales theorem.
		
		%les valeurs de $P_{1x}$ et $P_{3x}$ peuvent être %facilement calculée en utilisant le théorème de %Thalès :
		
		$$	
		P_{1x}=\frac{\bar{D}R_l}{R_s-R_l}
		$$ 
		$$	
		P_{3x}=\frac{\bar{D}R_l}{R_s(\alpha+1)-R_l}
		$$
		
		where $\bar{D}$ is the Solar-Moon distance, $R_s$ the Solar Radius ,$R_l$ the Lunar radius and $\alpha$ is the solar crown's added size in solar radius (the more $alpha$ is near of zero the more the solar crown's radius is near of the solar raidus meaning that we will observe part of the crown near of the solar surface)
		%où $\bar{D}$ est la distance Soleil-lune, $R_s$ le rayon solaire ,$R_l$ le rayon lunaire et $\alpha$ est la taille supplémentaire de la couronne solaire par rapport au rayon solaire( plus $alpha$ est proche de 0 plus on observera des parties de la couronne proche de la surface du soleil).
		
		we can then compute the position of $P_2$ by computing the intersection of the lines linking the surface of the Moon and the points $P_1$ and $P_3$
		
		%on peut ensuite calculer la position de $P_2$ en calculant l'intersection des lignes reliant la surface de la Lune au points $P_1$ et $P_3$ : 
		
		$$
		P_{2x}=\frac{P_{1x}tan(\theta_1) + P_{3x}tan(\theta_3)}{tan(\theta_1) + tan(\theta_3)}
		$$
		$$
		P_{2y}=tan(\theta_1)(P_{1x}-P_{2x})
		$$
		
		with
		$$
		\theta_1=\sin^{-1}\left(\frac{R_l}{P_{1x}}\right)
		$$
		
		$$
		\theta_3=\sin^{-1}\left(\frac{R_l}{P_{3x}}\right)
		$$
		
		with $\alpha=0.05$
		
		\subsection{approximation of the zone}
		the Position of the points $P_1$,$P_2$ and $P_3$ relative to the moon will change depending of the moon position around the earth, hovewer the shape of the the zone in itself will not change much (with a dimension error smaller than 0.5\%)
		
		%la position des points $P_1$,$P_2$ et $P_3$ par rapport à la Lune vont changer en fonction de sa position autour de la Terre. Cependant la forme de la zone en elle même varie assez peu (les dimensions variant de moins de 0.5\%).
		
		we can obtain a good approximation of the observation zone at any position of the moon around the Earth by computing the shape of the observation zone with the moon at the origin and then move it and rotate it to place it at the right position.
		%On peut donc obtenir une bonne approximation de la zone d'observation où que se trouve la Lune autours de la Terre en calculant la forme de la zone d'observation lorsque la Lune se trouve à la place de la Terre puis de la déformer pour se positionner là où se trouve la Lune.
		
		
		
		We name $\hat{P_1}$, $\hat{P_2}$ and $\hat{P_3}$ the points of the observation zone when the moon is at the origin. the points $P_1$ and $P_3$ are collinear with the vector $R_{ls}$ witch are the position of the Moon relative to the Sun.
		
		Also the points $\hat{P_1}$ $\hat{P_3}$ are colinear with the X axis. We can conclude of the following formula of the points $P_3$ and $P_1$
		
		%On nomme $\hat{P_1}$, $\hat{P_2}$ et $\hat{P_3}$ les points de la zone d'observation quand la Lune est à la place de La Terre. Les points $P_1$ et $P_3$ sont colinéaire avec le vecteur $R_{ls}$ qui représente la position de la Lune par rapport au Soleil.
		%De plus les points $\hat{P_1}$ $\hat{P_3}$ sont colinéaire avec l'axe X. On peut en déduire les formules suivantes de la position de $P_3$:
		
		$$
		\begin{equation}
			P_3=R_{lt}+\hat{P_{3x}}D^{-1}R_{ls} 
		\end{equation}
		$$
		$$
		\begin{equation}
			P_1=R_{lt}+\hat{P_{1x}}D^{-1}R_{ls} 
		\end{equation}
		$$
		
		%vérifier si un point $S$ est dans la zone d'observation revient à vérifier les inégalités suivantes:
		a point $D$ is consider in the observation zone if the following inequality are verified : 
		
		$$
		\begin{equation}
			\begin{align}
				||a||&<||b||p_1\\
				||a||&<O-||b||p_2
			\end{align}	
		\end{equation}
		$$
		
		with $b$ being the projection of $S-P_3$ on the axis Sun_Moon, $a=S-P_3-b$. $p_1$, $p_2$ and $O$ are real value: here this parameter will be approximated by their value when the Moon is at the origin :
		
		%avec $b$ la projection de $S-P_3$ sur l'axe Lune- Soleil, $a=S-P_3-b$ et $p_1$, $p_2$ et $O$ sont des réel à déterminer. On remarque que si la Lune est à l'origine on a
		
		$$
		\begin{align}
			p_1&=\frac{P_2y}{P_2x-P_3x}\\
			p_2&=\frac{P_2y}{P_1x-P_2x}\\
			O&=P_2y+(P_2x-P_3x)p_2
		\end{align}	
		$$ 
		
		%En supposant que la forme de la zone d'observation varie peu lorsque la lune se déplace, on peut utiliser les même coefficients où que se trouve la Lune.
		
		%Si on souhaite avoir une approximation un peu plus précise on peu prendre en compte la variation la plus importante sur la forme de la zone d'observation étant la variation de la longueur de la zone.
		
		if we want to increase the precision of the observation zone we can take in account the variation in length of the observation zone by scaling the parameter $b$ by 
		
		%On peut prendre en compte cette variation en multipliant $b$ par
		
		$\frac{||\hat{P_1}-\hat{P_3}||}{||P_1-P_3||}$		
		\subsection{numeric application}
		we have the following distances : 
		$$
		\begin{align}
			R_l&=1.7374\times10^6 m \\
			R_s&=6.955\times10^8 m \\ 
			D_{sl}&=1.496\times10^{11} m \\
			\Delta_D=2D_{tl}&= 7.69496\times10^8 m
		\end{align}
		$$
		
		we get the following value for the point of the Zone for $\alpha=0.05$
		%on obtient les valeur suivantes pour les points de la zone pour $\alpha=0.05$
		
		$$
		\begin{align}
			P_{3x}&=3.577\times10^8 m \\
			P_{1x}&=3.758\times10^8 m \\ 
			P_{1x}-P_{3x}&=1.7928\times10^7 m \\ 
			P_{2x}&=3.655\times10^8 m \\
			P_{2y}&= 4.248\times10^4 m
		\end{align}
		$$
		
		with
		
		$$
		\begin{align}
			\Delta_{P_{3x}}&=1.835\times10^6 m \\
			\Delta_{P_{1x}}&=1.927\times10^6 m \\ 
			\Delta_{P_{1x}-P_{3x}}&=9.198\times10^4 m \\ 
			\Delta_{P_{2x}-P_{3x}}&=4.487\times10^4 m \\ 
			\Delta_{P_{2x}}&=1.880\times10^6 m \\
			\Delta_{P_{2y}}&= 4.935\times10^{-3} m
		\end{align}
		$$
		
		
		we can see that by using the approximation defined earlier, we are neglecting variation of order lower than thousand of killometer ($10^6 m$).If we add the optimisation on the value of $b$ we are now neglecting variation of order lower than ten killometerss ($10^4 m$) leaving only error of a couple killometers on the  posisiton of $P_{2x}$ which is not a lot against the size of the observation zone : (around $ 20000 km $ by $100 km$).
		
		about the error on $P_{2y}$ the error is of the order of a millimeter and can clearly be neglected.
		
		%on observe qu'en utilisant l'approximation définie plus tôt, on néglige les variation de l'ordre du millier de kilomètres ($10^6 m$). et en ajoutant l'optimisation supplémentaire sur la valeur de $b$ on néglige également les variation de l'ordre de la dizaine de kilomètre ($10^4 m$) ne laissant que les erreurs de l'ordre de quelques kilomètre sur la position de $P_2x$ ce qui ne change pas grand chose compte tenu de la grande longueur de la zone par rapport à son épaisseur (environ $ 20000 km $ contre $100 km$)
		
		%la position de la zone d'observation va se déplacer avec la lune mais va aussi changer de direction et de forme.
		
		%on a $\bar{D}=\sqrt{D^2+2DX_l+r_l^2}$ où $D$ est la distance Terre-Soleil et $R_l=(X_l,Y_l,Z_l)$,$||R_l||=r_l$ la position de la lune relativement à la Terre. $||r_l||<<D$ donc on peut considérer que $\bar{D} \approx \sqrt{D(D+2X_l)}$
		
		%cette approximation crée une erreur sur les position de $X_1$ et $X_3$ de l'ordre $1000m$.
		
		%en prenant une valeur encore plus simplifié de $\bar{D}$ : $\bar{D}=D$ on obtient une erreur sur les positions de  $X_1$ et $X_3$ de l'ordre de $1000km$ mais on conserve une erreur assez faible sur la distance entre $X_1$ et $X_3$ (environ 0.25\% de la distance $X_1$$X_3$ ). Cela permet de considérer la zone d'observation comma ayant toujours la même forme (longueur et épaisseur).
		
		\section{problème}
		
		on va considérer le problème suivant:
		
		la lune suit une orbite circulaire autour de la Terre de rayon $a=384000km$.
		
		la forme de la zone d'observation de la Lune est considérée comme étant égale à la zone d'observation de la lune si elle se trouvait à l'origine (la position de la terre). La position du point $P_3$ est déterminé par la formule suivante:
		avec 
		$$
		P_3(R_l)=R_{lt}+\hat{P_{3x}}D^{-1}R_{ls}
		$$
		avec $\hat{P_3}$ étant la position du point $P_3$ quand la lune est à l'origine
		,$R_{lt}$ est la position de la lune relativement à la Terre.
		et $R_{ls}$ est la position de la Lune relativement au Soleil.
		
		(on a $R_{ls} = R_{lt}+D\hat{x}$);
		
		le but est de trouver des orbites Kepleriennes qui effectue des observations répété et les plus longues possibles.
		
		Les temps d'observation peuvent beaucoup varier allant d'une durée de quelques minutes à plusieurs heures.	dans la suite on va donc se concentrer sur une seule observation.
		
		afin de pouvoir reproduire les observations, il vaut mieux prendre une période d'orbite qui est un multiple de celle de la Lune.
		
		de ce fait on peut déterminer le demi grand axe du satellite avec la formule suivante:
		
		$$
		a_s=a_lk^{\frac{2}{3}}
		$$
		
		avec
		$$
		P_s=kP_l
		$$
		
		étant donné que l'objectif est de faire une observation, on peut faire partir le satellite directement de la zone d'observation.
		
		De plus la dimension de la zone étant très étirée (environ $10000km\times100km\times100km$) on peut considérer que le satellite coupera forcement le segment $[P_3,P_1]$, on peut donc décrire la position initiale du satellite à l'aide de l'anomalie vraie de la lune $\nu$ et un scalaire $\lambda$ entre 0 et 1. la position initiale du satellite devient : 
		$$
		S_0=\lambda(P_1-P_3)+P_3(R_l(\nu))
		$$
		
		avec 
		$$
		R_l(\nu)=\begin{bmatrix}
			r( \cos\Omega \cos\theta -\sin\Omega \sin\theta \cos\ i)\\
			r( \sin\Omega \cos\theta -\cos\Omega \sin\theta \cos\ i)\\
			r\sin\theta \sin\ i\ 
		\end{bmatrix}
		$$
		avec $\theta = \nu+\omega$ \\
		pour l'instant on est en 2D donc l'équation se simplifie par:
		$$
		X_l(\nu)=\begin{bmatrix}
			r \cos\theta \\
			r \sin\theta \\
			0 
		\end{bmatrix}
		$$
		
		Maintenant que l'on connait la position du satellite on peut déterminer sa vitesse à l'aide de la formule suivante:
		
		$$
		||\dot{S}(0)||=\sqrt{\frac{2\mu}{||S_0||}-\frac{\mu}{a_s}}
		$$
		
		on peut ensuite determiner l'orientation de la vitesse initiale avec deux angles $\theta_s$ et $\phi_s$.
		
		la dynamique du satellite et de la lune doivent être calculé pour calculer le temps de l'observation.
		
		on à la dynamique suivante :
		
		$$
		\begin{bmatrix}
			\dot{\overrightarrow{R_{s}}}\\
			\dot{\overrightarrow{V_{s}}}\\
			\dot{\overrightarrow{R_{l}}}\\
			\dot{\overrightarrow{V_{l}}}
		\end{bmatrix} =\begin{bmatrix}
			\overrightarrow{V_{s}}\\
			\frac{-\mu }{||R_{s} ||^{3}}\overrightarrow{R_{s}}\\
			\overrightarrow{V_{l}}\\
			\frac{-\mu }{||R_{l} ||^{3}}\overrightarrow{R_{l}}
		\end{bmatrix}
		$$
		
		avec comme condition initiale :
		
		
		$$
		\begin{bmatrix}
			\overrightarrow{R_{s0}}\\
			\overrightarrow{V_{s0}}\\
			\overrightarrow{R_{l0}}\\
			\overrightarrow{V_{l0}}
		\end{bmatrix} =\begin{bmatrix}
			\lambda \left(\widehat{P_{1}} -\widehat{P_{3}}\right) +R_{lt} +\frac{\widehat{P_{3x}}}{D} R_{ls}\\
			\sqrt{\mu \left(\frac{2}{||R_{s0} ||} -2\right)}\widehat{v_{0}}( \theta _{s} ,\phi _{s})\\
			r( \nu )\begin{bmatrix}
				( \cos\Omega \cos\theta -\sin\Omega \sin\theta \cos\ i)\\
				( \sin\Omega \cos\theta +\cos\Omega \sin\theta \cos\ i)\\
				\sin\theta \sin\ i
			\end{bmatrix}\\
			\sqrt{\frac{\mu }{p}}\begin{bmatrix}
				-\cos\Omega ( \sin\theta +e\ \sin\omega ) -\sin\Omega ( \cos\theta +e\ \cos\omega ) \cos\ i\\
				-\sin\Omega ( \sin\theta +e\ \sin\omega ) +\cos\Omega ( \cos\theta +e\ \cos\omega ) \cos\ i\\
				( \cos\theta +e\ \cos\omega ) \sin\ i
			\end{bmatrix}
		\end{bmatrix}
		$$
		
		la dynamique devra être simulée après et avant l'état initial pour trouver l'instant où l'objet entre et sort de la zone.
		
		la fonctions d'objectif est définit comme suit :
		
		$$
		\int_{-\tau_d}^{\tau_u}dx=\tau_d+\tau_u
		$$
		
		où $\tau_d$ est l'instant où l'objet rentre dans la zone d'observation et $\tau_u$ l'instant où l'objet en sort.
		
		l'équation utilisé pour vérifier si l'objet est dans la zone est l'équation (2).
		
		les paramètre de contrôle sont :
		
		\begin{itemize}
			\item la position de la lune $\nu$ qui définit la position de la zone d'observation.
			\item la position initiale $\lambda$ de l'objet dans la zone d'observation qui est simplifier par un segment allant de $P_3$ à $P_1$. 
			\item les angles $\theta_s$ et $\phi_s$ qui définissent l'orientation de la vitesse de l'objet.
		\end{itemize}
		
		on a donc un espace de dimension 4 :
		$(\nu,\lambda,\theta_s,\phi_s)=[0,2\pi]\times[0,1]\times[0,2\pi]\times[0,\pi]$
		
		l'espace est contraint mais étant donné que la plupart des dimension sont des angles et qu'il suffit de donner un score de 0 si $\lambda$ est en dehors du domaine on peut considéré que l'espace est égal à $\mathbb{R}^4$ pour avoir un problème sans contrainte.
		
		\section{Result}
		
		after studying the possible optimum it is shown that random initial condition tend to give obervation time of a few minutes, however observation that happen when the angle form by the Sun, Earth and Moon aproach 60° tend to be way higher .
		
		When we are working with a simple 2D problem with circular Moon orbit , there are an optimum near the value $(\2pi/3,0.5,38/45\pi,0)$ that give observation time of almost 20h.
		
		we managed to get observation time this long because the speed of the object and the Moon are equivalent. Meaning that the device can stay in the observation zone for a long time.
		
		The satellite describe a loop inside the observation zone, meaning that it is possible to get two fairly long observation very near to each other if the tip of the loop is outside of the observation zone. Even if there is a good chance that these solution are less efficient that a solution with the entire loop inside the observation zone, i could be usefull to improve the objective function to detect when the object reenter the observation zone after a short time.
		
		we can easily determine that there are two point in the lunar orbit where we can obtain very long observation time:
		
		The satellite can have the same speed vector as the moon only if the following equation is verified : 
		
		$$
		\begin{align}
			\sqrt{\frac{2\mu}{R_s}-\frac{\mu}{a_s}}&=\sqrt{\frac{2\mu}{R_l}-\frac{\mu}{a_l}}
		\end{align}
		$$
		
		Considering that the moon's speed is constant (because of its small eccentricity) and that the period of the device is the same as the moon (ie $a_s=a_l$), we get the relation :
		
		$$
		R_s=R_l
		$$
		
		as the satellite is in the obsevation zone, the region in which the satelite can cross the observation zone and at the same speed as the moon is the intersection between the possible observation zone space (which is in our case simplified by an ellipse) and a sphere of radius $R$ with $R=R_l$ in this case.
		
		There are two point in the orbit that satisfy these condition
		
		Using the solution that we found in 2D we can try to use it as an initial condition for 3D problems, the solution found with varying $\Omega$ value and considering the eccentricity of the Moon tend to show that there are always a solution near this point.
		
		\section{low thrust transfert}
		
		now that we know that the best configuration to make observation are with no relative speed, it mean that we can compare the different $\Delta v$ needed to transfert from one observation to another.
		
		the goal of this computing is to get an idea of which subset of observations could be done (as it is very likely that we won't be able to make the device attend all the observations).
		
		For now we will consider the simulation over one year, with the earth at the origin, the sun moving around the earth along a perfect circle with a radius of one UA at a constant speed and. The moon moving allong a keplerian orbit with the following component :
		
		$$
		\begin{align}
			\Omega&=0\\
			\omega&=0\\
			i&=5\\
			e&=0.054\\
			\nu&=0\\
		\end{align}
		$$
		
		The value of $\nu$ correspond to the true anomaly of the moon at time $t=0$ . the value of $\omega$ and $\Omega$ are set at 0 for now but we will test other value later.
		
		%as we can achieve zero velocity observation only if the distance of the Moon and the Earth and the distance between observation zone and the Earth are equal. Considering that the part where the observation is the more thickest is more likely to create long observation, we define the following payoff function to find optimum :
		
		we can achieve zero velocity observation if the velocity of the device at the observation zone ($\sqrt{\frac{2\mu}{R_s}-\frac{\mu}{a_l}$) is the same as the velocity of the observation zone. As the position of the point $P_{2x}$ is given by the following formula : 
			
			$$
			P_{2x}=R_l+\frac{D_{p2}}{D_{ts}}(R_s+R_s)
			$$
			where $D_{p2}$ is the distance between the moon and the point $P_{2x}$ where the moon is at the origin.
			so we have:
			$$
			\dot{P_{2x}}=\dot{R_l}+\frac{D_{p2}}{D_{ts}}(\dot{R_s}+\dot{R_s})
			$$
			
			we can get from this the following payoff formula :
			
			$$
			D_{obs}=\left(||\dot{P_{2x}}||-\sqrt{\frac{2\mu}{P_{2x}}-\frac{\mu}{a_l}}\right)^2
			$$  
			
			ploting the value of this function over one year give the follwoing graph :
			
			%insert graph here
			
			we can see that we have a almost a symetric and a periodic function, this mean that we just need to find the first optimum and then we could compute good initial value to find the other optimum of the function using the follwoing formulas : 
			
			$$
			\begin{align}
				O_{2n}_i&=nT-O_1+a\\
				O_{2n+1}_i&=nT+O_1+a
			\end{align}
			$$
			
			where $T$ is the synodic period of the Moon,
			$O_k_i$ is the initial value used to find the $k^{th}$ optimum of the function using a simple gradient descent method
			$O_1$ is the value of the first optimum of the function relative to $a$.
			
			and $a$ is the first time the Sun-Earth-Moon system align (when projected on the ecliptic plane of earth) in this order, for now the value $a$ is equal to zero.
			
			\subsection{low thrust model}
			
			we want to move from a point $R_i$ at time $t_i$ to a point $R_f$ at time $t_f$ with initial velocity $V_i$ and final velocity $V_f$.
			
			the device can be control with a low thrust engine that can generate an acceleration of maximum magnitude $A_{max}$ in any direction, as the final objective is to use a solar sail, the variation of mass is neglected.
			
			the passive dynamic of the device is the following : 
			$$
			\begin{bmatrix}
				\dot{r}\\
				\dot{v}
			\end{bmatrix} =\begin{bmatrix}
				v\\
				\sum\limits _{\beta \in B }\frac{\mu _{\beta }}{\| r_{\beta } -r\| ^{3}}( r_{\beta } -r)
			\end{bmatrix}
			$$
			
			where $B$ is the set of every bodies that attract the device (for now the two body are The Earth and the Moon). the dynamics of the bodies must be computed before (we suppose that the device does not influence the dynamics of the system).
			
			the acceleration of the thruster can be take in account by adding a vector the equations of speed : \\
			
			$$
			f(x,u)=\dot{x}=
			\begin{bmatrix}
				\dot{r}\\
				\dot{v}
			\end{bmatrix}
			=\begin{bmatrix}
				v\\
				u+\sum\limits _{\beta \in B }\frac{\mu _{\beta }}{\| r_{\beta } -r\| ^{3}}( r_{\beta } -r)
			\end{bmatrix}
			$$
			
			we want to minimize the $\Delta_v$ of the transfert, so the running payoff is :
			$$
			r(x,u)=-\|u\|
			$$ 
			
			we also want to be at the right position and velocity at the time $t_f$ so the terminal payoff is :
			
			$$
			g(x(t_f))=-(r(t_f)-R_f)^2-(v(t_f)-V_f)^2
			$$
			
			we get the following hamiltonian :
			
			$$
			H(x,p,u)=\begin{bmatrix}
				v\\
				u+\sum\limits _{\beta \in B }\frac{\mu _{\beta }}{\| r_{\beta } -r\| ^{3}}( r_{\beta } -r)
			\end{bmatrix}^t\cdot p-\|u\|
			$$
			
			using the Pontryagin maximum principle theorem we can compute the differential of $p=\begin{bmatrix}p_r\\p_v\end{bmatrix}$
			
			$$
			\begin{align}
				\dot{p}=&-\nabla _{x}H\\
				=&-\begin{bmatrix}
					0 & I_3\\
					\sum\limits _{\beta \in B }\frac{\mu _{\beta }}{\| r_{\beta } -r\| ^{3}}\left(\frac{3( r_{\beta } -r) \cdot ( r_{\beta } -r)^{t}}{\| r_{\beta } -r\| ^{2}} -I_3\right) & 0
				\end{bmatrix}^{t} \cdot p\\
				=&\begin{bmatrix}
					\sum\limits _{\beta \in B }\frac{\mu _{\beta }}{\| r_{\beta } -r\| ^{3}}\left(I_3-\frac{3( r_{\beta } -r) \cdot ( r_{\beta } -r)^{t}}{\| r_{\beta } -r\| ^{2}} \right)\cdot p_v\\
					-p_r
				\end{bmatrix}
			\end{align}
			$$
			
			we know that $\forall t$ , $u=\arg\max_{u\in B(0,A_{max})}H(x,p,u)$. We can rewrite the hamiltonian as follow : 
			$$
			\begin{align}
				H(x,p,u)=&C(x,p)+u\cdot p_v-\|u\| \\
				=&C(x,p)+\|u\|(\|p_v\|\cos(\alpha_{\widehat{up_v}})-1)
			\end{align}
			$$ 
			
			with this form we can easily conclude that 
			$$
			\begin{cases}
				\| u\| =A_{max} & \text{if } \|p_v\|\cos(\alpha_{\widehat{up_v}})\ge1\\
				\| u\| =0 & \text{else}
			\end{cases}
			$$
			
			we can then observe that $\|p_v\|\cos(\alpha_{\widehat{ap_v}})$ cannot be greater than $1$ if $\|p_v\| < 1$. Also if $\|p_v\| \ge 1$, it is obvious that taking $\alpha_{\widehat{up_v}}=0$ (i.e. $u$ and $p_v$ are collinear) maximize the factor $\|p_v\|\cos(\alpha_{\widehat{uap_v}})$. So we can conclude the following formula :
			
			$$
			\begin{cases}
				 u =A_{max}\widehat{p_v} & \text{if }\|p_v\| \ge 1\\
				 u =0 & \text{else}
			\end{cases}
			$$
			
			to solve the problem numerically, we then just have to find the correct value $p_i$ so the terminal value of $x$ correspond to the target value.
			
			\section{result low thrust}
				\\
			to compute the solution, i've used the julia library : OptimalControl,
			
			the starting point of the device is the exting point where of starting observation and the ending point is the enter point of the ending observation.
			
			To simplify the next explication i will separate the observations into two category : the even observations and the odd observation. The odd observations are the first observation that happen on the moon orbit and the even one are the second one. another way to see this is to consider that the odd observations are the observation occuring when the device is aproaching earth and the odd observation is when the device is moving away from earth
			
			The algorithm had a lot of struggle to find an optimum for moving to two adjacent observations, which was excpected as the two orbit of adjacent optimum are very different and the time interval is small meaning that important $\Delta_v$ are needed to move from the starting point to the ending point. hovewer the algorithm find solution for transition between even observation and between odd observation. This was also excpected as the starting and objective orbit are very similar with the main difference being only a rotation of $\frac{P_{moon}}{P_{sol}}2\pi $ rad caused by the movement of the sun.
			\\ \\
			for 1 in 2 transfert, the maximum acceleration found was betweeen $170 \mu{N}\cdot\text{Kg}$ and $200 \mu{N}\cdot\text{Kg}$ which is around the acceleration we can get from electric engine but not from solar sail.
		
			there are also another type of transfert that caught my interest, it is transfert from odd observation to even observation (1 in 3 transfert starting from odd observation) which seem to be very easy to do with maximum acceleration ranging from  $50 \mu{N}\cdot\text{Kg}$ to $95 \mu{N}\cdot\text{Kg}$. It truned out that the angle between an odd orbit and a even orbit orbit is around the same length of the angle describe by the movement of the sun in $\frac{4}{3}$ of the moon synodic period, this mean that the starting and ending orbit in such transfert are almost the same with the only main task being to change the true anomaly. This transferts could look like they are a good alternative to reduce maximum acceleration during transfert but the problem is that once we reached the odd observation, we have to make a transfert from even to odd and in this case the situation is reverse with the angles being added and not substracted, causing high maximum acceleration.
			\\ \\
			In fact making fewer observation doesn't seem to reduce the maximum acceleration needed or even the $\Delta_{V}$ which could look counter intuitive at first glance but is not when we think aboout the fact that orbits become increasingly different from each other with time. This mean that there are some kind of minimum power needed for making observations which must be around the amount of power needed to rotate the observation orbit by $360^\circ$ every year. Though it is possible to jump a lot of observations to the point that we don't need to rotate the orbit all around the Earth. Like with the obvious example of making an observation every year, when the sun is roughly at the same place relative to the Earth-Moon system. But the counter part is that we will be making way less observations ... at most one every 6 mouths. 
			\\ \\
			What look like the best scenario at this point would be to put two devices capable of delivering acceleration of the order of $200\mu{m}\cdot\text{s}^2$, one for the odd observation and one for the even observation. This would allow to attends every observations which mean that we will be able to observe the solar corona around $3\%$ of the mission time with even the possibility of observing the sun at the same time.
			
	
		\end{document}